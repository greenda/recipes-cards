<!-- https://color.romanuke.com/czvetovaya-palitra-4528/ -->
<!-- #5C7728
#F8AE29
#F7F7F9
#FFC9B3
#B76C49 -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: monospace;
    }

    .page {
      padding: 24px;
      display: grid;
      grid-template-columns: 1fr 800px 1fr;
    }

    .page__title {
      display: grid;
      justify-content: center;
    }

    .table__head {
      display: grid;
      grid-template-columns: 226px 226px 226px 36px 36px;
      height: 42px;
      background: #DBB6A4;
    }

    .table__head div {
      /* border: 4px solid white; */
      display: grid;
      justify-items: center;
      align-items: center;
      padding: 8px 0px;
      border-bottom: 0;
    }

    .table__head div:not(:last-child) {
      border-right: 0;
    }

    /* TODO миксин */
    .table__row {
      display: grid;
      grid-template-columns: 226px 226px 226px 32px 32px;
      border: 1px solid #E5E5E5;
      border-top: 0;
      border-bottom: 0;
    }

    .table__row:last-child {
      border: 1px solid #E5E5E5;
    }

    .table__cell {
      padding: 8px;
      border-bottom: 0;
    }

    .table__cell:not(:last-child) {
      border-right: 0px;
    }

    .table {
      width: 752px;
      font-size: 16px;
      color: #1B1D19;
      margin: 24px;
    }

    .table button {
      padding: 0px;
    }

    .table input {
      border: none;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #d9d9d9;
      font-size: 16px;
    }

    .add-button {
      background-image: url(edit-icon.svg);
      background-size: 100%;
      width: 32px;
      height: 32px;
      /* background: mediumaquamarine; */
      border: none;
      background-color: transparent;
    }

    .delete-button {
      background-image: url(cancell-icon.svg);
      background-size: 100%;
      width: 32px;
      height: 32px;
      /* background: mediumaquamarine; */
      border: none;
      background-color: transparent;
    }

    .table input:focus {
      border: 1px solid #d9d9d9;
      outline-color: #d9d9d9;
    }

    .table input:focus-visible {
      border: 1px solid #d9d9d9;
      outline-color: #d9d9d9;
    }

    .table input:active {
      border: 1px solid red;
    }

    .table__cell_type_ingredients div:not(:last-child) {
      margin-bottom: 4px;
    }

    .table__cell_type_units div:not(:last-child) {
      margin-bottom: 4px;
    }

    .text-input input {
      width: 192px;
    }

    .table__active-button {
      padding: 0;
      display: grid;
      align-items: center;
    }
  </style>
  <script type="module" src="./src/app/components/select-with-search/index.js"></script>
  <script>
    // console.log('%c%s', 'background: cadetblue; padding: 8px;', 'loadTemplates');
    // const loadTemplates = async () => {
    //   //get the imported document in templates:
    //   var templates = document.createElement( 'template' )
    //   templates.innerHTML = await ( await fetch( 'templates.html' ) ).text();
    // };

    // const loadTemplates = () => {
    //
    // }


  </script>
  <!-- <script src="./src/index.js"></script> -->
  <title>Document</title>
</head>

<body>
  <div w3-include-html="templates.html"></div>
  <script>
    // const loadTemplates = async () => {
    //   var templates = document.createElement( 'template' )
    //   // const templatesFile = await fetch( 'templates.html' );
    //   templates.innerHTML = await ( await fetch( 'templates.html' ) ).text();
    //   document.querySelector('body').appendChild(templates);
    // };

    // loadTemplates();
  </script>
  <div class="page">
    <template id="select-with-search">
      <style>
        .select__add-button {
          background-image: url('add-icon.svg');
          width: 24px;
          height: 24px;
          border: none;
          background-color: transparent;
        }

        .select__add-button:hover {
          background-image: url('add-icon_hover.svg');
        }

        .select__container {
          position: absolute;
          background: white;
          display: block;
          border: 1px solid #E5E5E5;
          width: 180px;
          box-shadow: 0px 2px 8px 0px rgb(34 60 80 / 20%);
        }

        .select__option {
          padding: 8px;
          border-bottom: 1px solid #E5E5E5;
        }

        .select__option:hover {
          background-color: #F8AE29;
        }

        .select__field {
          display: grid;
          grid-template-columns: 182px 24px;
          gap: 4px;
          align-items: center;
          position: relative;
        }

        .select input {
          border: none;
          padding: 8px;
          border-radius: 4px;
          border: 1px solid #d9d9d9;
          font-size: 16px;
        }

        .select input:focus-visible {
          outline: 1px solid #B0B0B0;
        }

        .select__hide-button {
          position: absolute;
          background-image: url(./hide-select-button.svg);
          background-color: transparent;
          border: none;
          height: 36px;
          width: 30px;
          left: 152px;
          background-repeat: no-repeat;
          background-position-y: 16px;
          background-position-x: 8px;
          padding: 0;
        }

        .select__container.hide {
          display: none;
        }
      </style>

      <!-- TODO сделать это через b() -->
      <div class="select">
        <div class="select__field">
          <input type="text" class="select__input" />
          <button class="select__add-button"></button>
          <button class="select__hide-button"></button>
        </div>
        <div class="select__container  hide">
        </div>
      </div>
    </template>
    <div></div>
    <div>
      <div class="page__title">
        <h1>Добавление рецепта</h1>
      </div>
      <div class="table">
        <div class="table__head">
          <div>
            Ингредиент
          </div>
          <div>
            Количество
          </div>
          <div>
            Единицы измерения
          </div>
          <div class="table__head_type_button"></div>
          <div class="table__head_type_button"></div>
        </div>
        <div class="table__content">
          <div class="table__row">
            <div class="table__cell">
              <select-with-search id="s1"></select-with-search>
            </div>
            <div class="table__cell">
              <div class="text-input">
                <input type="text" />
              </div>
            </div>
            <div class="table__cell">
              <select-with-search id="s2"></select-with-search>
            </div>
            <div class="table__cell table__active-button">
              <button class="add-button"></button>
            </div>
            <div class="table__cell  table__active-button">
              <button class="delete-button"></button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div></div>
  </div>
  <script>
    onAddOption = event => {
      const newId = Math.max(...INGREDIENTS.map(({ id }) => id)) + 1;

      updateIngredients([...INGREDIENTS, { id: newId, label: event.currentTarget.newOption }]);
    }

    // const INGREDIENTS = [
    //   { id: 1, label: 'Свекла' },
    //   { id: 2, label: 'Морковь' },
    //   { id: 3, label: 'Мясо' },
    // ];

    const updateIngredients = ingredients => {
      window.table.ingredients.forEach(select => {
        select.setAttribute('options', JSON.stringify(ingredients));
      });
    }

    fetch('./ingredients.js')
      .then((res) => res.text())
      .then((text) => {
        window.INGREDIENTS = JSON.parse(text).map(({ id, name }) => ({ id, label: name }))

        window.ingredients = INGREDIENTS;
        window.table = {
          ingredients: [s1, s2],
        };

        window.table.ingredients.forEach(select => {
          select.addEventListener('addOption', onAddOption);
        });

        updateIngredients(INGREDIENTS);

      });


  </script>
</body>

</html>
